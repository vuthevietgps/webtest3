<div class="product-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1>üõçÔ∏è Qu·∫£n L√Ω S·∫£n Ph·∫©m</h1>
      <p>Qu·∫£n l√Ω th√¥ng tin s·∫£n ph·∫©m trong h·ªá th·ªëng</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openAddModal()">
        <span class="icon">‚ûï</span>
        Th√™m M·ªõi
      </button>
      <button class="btn btn-secondary" (click)="seedData()">
        <span class="icon">üå±</span>
        T·∫°o D·ªØ Li·ªáu M·∫´u
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().totalProducts }}</div>
        <div class="stat-label">T·ªïng S·∫£n Ph·∫©m</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <div class="stat-number">{{ formatCurrency(stats().totalValue) }}</div>
        <div class="stat-label">T·ªïng Gi√° Tr·ªã</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <div class="stat-number">{{ formatCurrency(stats().averageImportPrice) }}</div>
        <div class="stat-label">Gi√° Nh·∫≠p TB</div>
      </div>
    </div>
    <div class="stat-card warning">
      <div class="stat-icon">‚ö†Ô∏è</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().lowStockCount }}</div>
        <div class="stat-label">S·∫Øp H·∫øt H√†ng</div>
      </div>
    </div>
    <div class="stat-card danger">
      <div class="stat-icon">üö´</div>
      <div class="stat-content">
        <div class="stat-number">{{ stats().outOfStockCount }}</div>
        <div class="stat-label">H·∫øt H√†ng</div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error()" class="error-banner" (click)="clearError()">
    <span class="error-icon">‚ö†Ô∏è</span>
    <span class="error-text">{{ error() }}</span>
    <span class="error-close">‚úï</span>
  </div>

  <!-- Search and Filters -->
  <div class="filters">
    <div class="filter-group">
      <input
        type="text"
        placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..."
        class="search-input"
        [value]="searchTerm()"
        (input)="onSearchChange($event)"
      />
    </div>
    <div class="filter-group">
      <select
        class="filter-select"
        [value]="selectedStatus()"
        (change)="onStatusFilterChange($event)"
      >
        <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
        <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
      </select>
    </div>
    <div class="filter-group">
      <select
        class="filter-select"
        [value]="selectedCategory()"
        (change)="onCategoryFilterChange($event)"
      >
        <option value="all">T·∫•t c·∫£ danh m·ª•c</option>
        <option *ngFor="let category of categories()" [value]="category._id">
          {{ category.icon }} {{ category.name }}
        </option>
      </select>
    </div>
  </div>

  <!-- Products Table -->
  <div class="table-container">
    <div *ngIf="isLoading()" class="loading">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
    </div>

    <table *ngIf="!isLoading()" class="products-table">
      <thead>
        <tr>
          <th>M√£ SKU</th>
          <th>T√™n S·∫£n Ph·∫©m</th>
          <th>Danh M·ª•c</th>
          <th>Gi√° Nh·∫≠p</th>
          <th>Tr·∫°ng Th√°i</th>
          <th>Thao T√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts()" class="product-row">
          <td class="sku-cell">{{ product.sku }}</td>
          <td class="name-cell">
            <div class="product-name">{{ product.name }}</div>
            <div *ngIf="product.notes" class="product-notes">{{ product.notes }}</div>
          </td>
          <td class="category-cell">
            <div class="category-badge" [style.background-color]="product.categoryId.color">
              <span class="category-icon">{{ product.categoryId.icon }}</span>
              <span class="category-name">{{ product.categoryId.name }}</span>
            </div>
          </td>
          <td class="price-cell">{{ formatCurrency(product.importPrice) }}</td>
          <td class="status-cell">
            <span class="status-badge" [class]="product.status === 'Ho·∫°t ƒë·ªông' ? 'active' : 'inactive'">
              {{ product.status }}
            </span>
          </td>
          <td class="actions-cell">
            <button class="btn-icon btn-edit" (click)="openEditModal(product)" title="Ch·ªânh s·ª≠a">
              ‚úèÔ∏è
            </button>
            <button class="btn-icon btn-delete" (click)="deleteProduct(product)" title="X√≥a">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading() && filteredProducts().length === 0" class="empty-state">
      <div class="empty-icon">üì¶</div>
      <h3>Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o</h3>
      <p>H√£y th√™m s·∫£n ph·∫©m ƒë·∫ßu ti√™n ho·∫∑c ƒëi·ªÅu ch·ªânh b·ªô l·ªçc t√¨m ki·∫øm</p>
      <button class="btn btn-primary" (click)="openAddModal()">
        <span class="icon">‚ûï</span>
        Th√™m S·∫£n Ph·∫©m ƒê·∫ßu Ti√™n
      </button>
    </div>
  </div>
</div>

<!-- Add Product Modal -->
<div *ngIf="isAddModalOpen()" class="modal-overlay" (click)="closeAddModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚ûï Th√™m S·∫£n Ph·∫©m M·ªõi</h2>
      <button class="modal-close" (click)="closeAddModal()">‚úï</button>
    </div>

    <form class="modal-form" (ngSubmit)="createProduct()">
      <div class="form-grid">
        <div class="form-group">
          <label for="name">T√™n S·∫£n Ph·∫©m *</label>
          <input
            type="text"
            id="name"
            required
            [value]="formData().name"
            (input)="onInputChange('name', $event)"
            placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m"
          />
        </div>

        <div class="form-group">
          <label for="categoryId">Danh M·ª•c *</label>
          <select
            id="categoryId"
            required
            [value]="formData().categoryId"
            (change)="onInputChange('categoryId', $event)"
          >
            <option value="">Ch·ªçn danh m·ª•c</option>
            <option *ngFor="let category of categories()" [value]="category._id">
              {{ category.icon }} {{ category.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="importPrice">Gi√° Nh·∫≠p (VND) *</label>
          <input
            type="number"
            id="importPrice"
            required
            min="0"
            step="1000"
            [value]="formData().importPrice"
            (input)="onInputChange('importPrice', $event)"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="shippingCost">Chi Ph√≠ V·∫≠n Chuy·ªÉn (VND)</label>
          <input
            type="number"
            id="shippingCost"
            min="0"
            step="1000"
            [value]="formData().shippingCost"
            (input)="onInputChange('shippingCost', $event)"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="packagingCost">Chi Ph√≠ ƒê√≥ng G√≥i (VND)</label>
          <input
            type="number"
            id="packagingCost"
            min="0"
            step="1000"
            [value]="formData().packagingCost"
            (input)="onInputChange('packagingCost', $event)"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="minStock">T·ªìn Kho T·ªëi Thi·ªÉu</label>
          <input
            type="number"
            id="minStock"
            min="0"
            [value]="formData().minStock"
            (input)="onInputChange('minStock', $event)"
            placeholder="10"
          />
        </div>

        <div class="form-group">
          <label for="maxStock">T·ªìn Kho T·ªëi ƒêa</label>
          <input
            type="number"
            id="maxStock"
            min="0"
            [value]="formData().maxStock"
            (input)="onInputChange('maxStock', $event)"
            placeholder="100"
          />
        </div>

        <div class="form-group">
          <label for="estimatedDeliveryDays">Th·ªùi Gian Giao H√†ng (ng√†y)</label>
          <input
            type="number"
            id="estimatedDeliveryDays"
            min="1"
            [value]="formData().estimatedDeliveryDays"
            (input)="onInputChange('estimatedDeliveryDays', $event)"
            placeholder="1"
          />
        </div>

        <div class="form-group">
          <label for="status">Tr·∫°ng Th√°i</label>
          <select
            id="status"
            [value]="formData().status"
            (change)="onInputChange('status', $event)"
          >
            <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
            <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label for="notes">Ghi Ch√∫</label>
          <textarea
            id="notes"
            rows="3"
            [value]="formData().notes"
            (input)="onInputChange('notes', $event)"
            placeholder="Ghi ch√∫ v·ªÅ s·∫£n ph·∫©m..."
          ></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeAddModal()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
          <span *ngIf="isLoading()" class="spinner small"></span>
          {{ isLoading() ? 'ƒêang t·∫°o...' : 'T·∫°o S·∫£n Ph·∫©m' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Product Modal -->
<div *ngIf="isEditModalOpen()" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>‚úèÔ∏è Ch·ªânh S·ª≠a S·∫£n Ph·∫©m</h2>
      <button class="modal-close" (click)="closeEditModal()">‚úï</button>
    </div>

    <form class="modal-form" (ngSubmit)="updateProduct()">
      <div class="form-grid">
        <div class="form-group">
          <label for="edit-name">T√™n S·∫£n Ph·∫©m *</label>
          <input
            type="text"
            id="edit-name"
            required
            [value]="formData().name"
            (input)="onInputChange('name', $event)"
            placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m"
          />
        </div>

        <div class="form-group">
          <label for="edit-categoryId">Danh M·ª•c *</label>
          <select
            id="edit-categoryId"
            required
            [value]="formData().categoryId"
            (change)="onInputChange('categoryId', $event)"
          >
            <option value="">Ch·ªçn danh m·ª•c</option>
            <option *ngFor="let category of categories()" [value]="category._id">
              {{ category.icon }} {{ category.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit-importPrice">Gi√° Nh·∫≠p (VND) *</label>
          <input
            type="number"
            id="edit-importPrice"
            required
            min="0"
            step="1000"
            [value]="formData().importPrice"
            (input)="onInputChange('importPrice', $event)"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="edit-shippingCost">Chi Ph√≠ V·∫≠n Chuy·ªÉn (VND)</label>
          <input
            type="number"
            id="edit-shippingCost"
            min="0"
            step="1000"
            [value]="formData().shippingCost"
            (input)="onInputChange('shippingCost', $event)"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="edit-packagingCost">Chi Ph√≠ ƒê√≥ng G√≥i (VND)</label>
          <input
            type="number"
            id="edit-packagingCost"
            min="0"
            step="1000"
            [value]="formData().packagingCost"
            (input)="onInputChange('packagingCost', $event)"
            placeholder="0"
          />
        </div>

        <div class="form-group">
          <label for="edit-minStock">T·ªìn Kho T·ªëi Thi·ªÉu</label>
          <input
            type="number"
            id="edit-minStock"
            min="0"
            [value]="formData().minStock"
            (input)="onInputChange('minStock', $event)"
            placeholder="10"
          />
        </div>

        <div class="form-group">
          <label for="edit-maxStock">T·ªìn Kho T·ªëi ƒêa</label>
          <input
            type="number"
            id="edit-maxStock"
            min="0"
            [value]="formData().maxStock"
            (input)="onInputChange('maxStock', $event)"
            placeholder="100"
          />
        </div>

        <div class="form-group">
          <label for="edit-estimatedDeliveryDays">Th·ªùi Gian Giao H√†ng (ng√†y)</label>
          <input
            type="number"
            id="edit-estimatedDeliveryDays"
            min="1"
            [value]="formData().estimatedDeliveryDays"
            (input)="onInputChange('estimatedDeliveryDays', $event)"
            placeholder="1"
          />
        </div>

        <div class="form-group">
          <label for="edit-status">Tr·∫°ng Th√°i</label>
          <select
            id="edit-status"
            [value]="formData().status"
            (change)="onInputChange('status', $event)"
          >
            <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
            <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label for="edit-notes">Ghi Ch√∫</label>
          <textarea
            id="edit-notes"
            rows="3"
            [value]="formData().notes"
            (input)="onInputChange('notes', $event)"
            placeholder="Ghi ch√∫ v·ªÅ s·∫£n ph·∫©m..."
          ></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">
          H·ªßy
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
          <span *ngIf="isLoading()" class="spinner small"></span>
          {{ isLoading() ? 'ƒêang c·∫≠p nh·∫≠t...' : 'C·∫≠p Nh·∫≠t' }}
        </button>
      </div>
    </form>
  </div>
</div>
